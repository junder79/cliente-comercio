<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <title>Comercio</title>
  </head>
  <body>
    <h1>Tienda Online</h1>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
    -->

  
    <div class="container">
       <div class="row">
        <div class="col-sm-12 col-md-6">
          <div class="form-group">
            <label for="inputBuscar">Buscar</label>
            <input type="text" class="form-control" id="inputBuscar" placeholder="Buscar Producto">
          </div>
        </div>
        <div class="col-sm-12 col-md-6">
    <div class="form-group">
      <div id="selectCategorias"></div>
    </div>
        </div>

       
       </div>
       <div class="d-flex justify-content-center">
        <div class="spinner-border"  id="preloader" style="width: 3rem; height: 3rem;display: none;" role="status">
          <span class="sr-only">Loading...</span>
        </div>
       </div>
        <div id="dataPeticion"></div>
    
    </div>
       
  </div>
    <script>
      $(document).ready(function () {
        getCategorias();
        getProductos();
      
      });

      function getProductos(){
        $('#preloader').css('display','block');
        fetch('http://localhost/api-rest/public/productos')
            .then(function (response) {
               
              $('#preloader').css('display','none');
               return response.json();
              
            })
            .then(function (data) {
            
                appendData(data);
            })
            .catch(function (err) {
                console.log('error: ' + err);
            });
        function appendData(data) {
            let output = '<div class="row">';
            var mainContainer = document.getElementById("dataPeticion");
            for (var i = 0; i < data.length; i++) {
                output += `
               
          <div class='col-3'>
            <div class="card ml-2 mt-2 " style="">
        <img src="${data[i].url_image}" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">${data[i].name}</h5>
          <a href="#" class="btn btn-primary">${data[i].price}</a>
        </div>
      </div></div>
      
        `;
       
            }
            output += '</div>'
            document.getElementById('dataPeticion').innerHTML = output; 
        }
      }
      function getCategorias(){
          fetch('http://localhost/api-rest/public/categorias')
            .then(function (response) {

               return response.json();              
            })
            .then(function (data) {
              let output = ' <label for="categorias">Seleccione Tipo de Producto</label><select class="form-control categorias" onchange="selectCategorias(event)" id="categorias"> <option value="" selected disabled>Seleccione</option><option value="0" >Mostrar Todo</option>';
              for (var i = 0; i < data.length; i++) {
                output += `  
                <option value="${data[i].id}">${data[i].name}</option>
      `;
            }
            output += '</select>'
            document.getElementById('selectCategorias').innerHTML = output; 
            })
            .catch(function (err) {
                console.log('error: ' + err);
            });

            
        }

        function getCategoriasFiltrada(idCategoria){
          $('#preloader').css('display','block');
          $('#dataPeticion').html('');
          if(idCategoria == 0 ){
            getProductos();
              return false;
          }
          fetch('http://localhost/api-rest/public/filtradoCategorias/'+idCategoria)
            .then(function (response) {
              $('#preloader').css('display','none');
               return response.json();              
            })
            .then(function (data) {
              let output = '<div class="row">';
            var mainContainer = document.getElementById("dataPeticion");
            for (var i = 0; i < data.length; i++) {
                output += `
               
          <div class='col-3'>
            <div class="card ml-2 mt-2 " style="">
        <img src="${data[i].url_image}" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">${data[i].name}</h5>
          <a href="#" class="btn btn-primary">${data[i].price}</a>
        </div>
      </div></div>
      
        `;
       
            }
            output += '</div>'
            document.getElementById('dataPeticion').innerHTML = output; 
            })
            .catch(function (err) {
                console.log('error: ' + err);
            });

            
        }

        function selectCategorias(event) {

      var elemento = event.target;
      var idCategoria = elemento.value;
      getCategoriasFiltrada(idCategoria);
      
      }
        $('#inputBuscar').change(function (e) { 
            e.preventDefault();
            var buscar = $(this).val();
            $('#preloader').css('display','block');
            if(buscar == ''){
              getProductos();
            }else {
              document.getElementById('dataPeticion').innerHTML = ''; 
            fetch('http://localhost/api-rest/public/buscar/'+buscar)
            .then(function (response) {
               
              $('#preloader').css('display','none');
               return response.json();
              
            })
            .then(function (data) {
             
                appendData(data);
            })
            .catch(function (err) {
                console.log('error: ' + err);
            });
        function appendData(data) {
            let output = '<div class="row">';
            var mainContainer = document.getElementById("dataPeticion");
            for (var i = 0; i < data.length; i++) {
                output += `
               
          <div class='col-3'>
            <div class="card ml-2 mt-2 " style="">
        <img src="${data[i].url_image}" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">${data[i].name}</h5>
          <a href="#" class="btn btn-primary">${data[i].price}</a>
        </div>
      </div></div>
      
        `;
       
            }
            output += '</div>'
            document.getElementById('dataPeticion').innerHTML = output; 
        }
            }
        

        });
     
    </script>
  </body>
</html>